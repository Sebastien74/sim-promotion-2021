CodeMirror.extendMode("css",{commentStart:"/*",commentEnd:"*/",wordWrapChars:[";","\\{","\\}"],autoFormatLineBreaks:function(e){return e.replace(new RegExp("(;|\\{|\\})([^\r\n])","g"),"$1\n$2")}}),CodeMirror.extendMode("javascript",{commentStart:"/*",commentEnd:"*/",wordWrapChars:[";","\\{","\\}"],autoFormatLineBreaks:function(e){var n=0,r=this.jsonMode?function(e){return e.replace(/([,{])/g,"$1\n").replace(/}/g,"\n}")}:function(e){return e.replace(/(;|\{|\})([^\r\n;])/g,"$1\n$2")},t=function(e){for(var n=[/for\s*?\((.*?)\)/,/\"(.*?)(\"|$)/,/\'(.*?)(\'|$)/,/\/\*(.*?)(\*\/|$)/,/\/\/.*/],r=[],t=0;t<n.length;t++)for(var o=0;o<e.length;){var a=e.substr(o).match(n[t]);if(null==a)break;r.push({start:o+a.index,end:o+a.index+a[0].length}),o+=a.index+Math.max(1,a[0].length)}return r.sort(function(e,n){return e.start-n.start}),r}(e),o="";if(null!=t){for(var a=0;a<t.length;a++)t[a].start>n&&(o+=r(e.substring(n,t[a].start)),n=t[a].start),t[a].start<=n&&t[a].end>=n&&(o+=e.substring(n,t[a].end),n=t[a].end);n<e.length&&(o+=r(e.substr(n)))}else o=r(e);return o.replace(/^\n*|\n*$/,"")}}),CodeMirror.extendMode("xml",{commentStart:"\x3c!--",commentEnd:"--\x3e",wordWrapChars:[">"],autoFormatLineBreaks:function(e){for(var n=e.split("\n"),r=new RegExp("(^\\s*?<|^[^<]*?)(.+)(>\\s*?$|[^>]*?$)"),t=new RegExp("<","g"),o=new RegExp("(>)([^\r\n])","g"),a=0;a<n.length;a++){var i=n[a].match(r);null!=i&&3<i.length&&(n[a]=i[1]+i[2].replace(t,"\n$&").replace(o,"$1\n$2")+i[3])}return n.join("\n")}}),CodeMirror.defineExtension("commentRange",function(t,o,a){var e,n,i=(e=this,n=o,CodeMirror.innerMode(e.getMode(),e.getTokenAt(n).state).mode),s=this;this.operation(function(){var e,n,r;t?(s.replaceRange(i.commentEnd,a),s.replaceRange(i.commentStart,o),o.line==a.line&&o.ch==a.ch&&s.setCursor(o.line,o.ch+i.commentStart.length)):(n=(e=s.getRange(o,a)).indexOf(i.commentStart),r=e.lastIndexOf(i.commentEnd),-1<n&&-1<r&&n<r&&(e=e.substr(0,n)+e.substring(n+i.commentStart.length,r)+e.substr(r+i.commentEnd.length)),s.replaceRange(e,o,a))})}),CodeMirror.defineExtension("autoIndentRange",function(n,r){var t=this;this.operation(function(){for(var e=n.line;e<=r.line;e++)t.indentLine(e,"smart")})}),CodeMirror.defineExtension("autoFormatRange",function(l,u){var g=this;g.operation(function(){for(var e=l.line,n=u.line;e<=n;++e){for(var r={line:e,ch:e==l.line?l.ch:0},t={line:e,ch:e==n?u.ch:null},o=function(e,n,r,t){var o=e.getMode(),a=e.getLine(n);if(null==t&&(t=a.length),!o.innerMode)return[{from:r,to:t,mode:o}];var i=e.getTokenAt({line:n,ch:r}).state,s=CodeMirror.innerMode(o,i).mode,c=[],d=new CodeMirror.StringStream(a);for(d.pos=d.start=r;;){o.token(d,i);var m,l=CodeMirror.innerMode(o,i).mode;if(l!=s&&(m=d.start,"xml"==s.name&&">"==a.charAt(d.pos-1)&&(m=d.pos),c.push({from:r,to:m,mode:s}),r=m,s=l),d.pos>=t)break;d.start=d.pos}return r<t&&c.push({from:r,to:t,mode:s}),c}(g,e,r.ch,t.ch),a="",i=g.getRange(r,t),s=0;s<o.length;++s){var c=1<o.length?i.slice(o[s].from,o[s].to):i;a&&(a+="\n"),o[s].mode.autoFormatLineBreaks?a+=o[s].mode.autoFormatLineBreaks(c):a+=i}if(a!=i){for(var d=0,m=a.indexOf("\n");-1!=m;m=a.indexOf("\n",m+1),++d);g.replaceRange(a,r,t),e+=d,n+=d}}for(e=l.line+1;e<=n;++e)g.indentLine(e,"smart");g.setSelection(l,g.getCursor(!1))})});